/*eslint-env node*/
/*eslint-env mocha*/

const summaryBotConstructor = require('../summaryBot.js')
const Vertex = require('../summaryBotVertex.js')
const chai = require('chai')
const spies = require('chai-spies')
chai.use(spies)
chai.should()
let summaryBot = new summaryBotConstructor()
const expect = require('chai').expect;


describe('summaryBot', () => {
  beforeEach(function () {
    summaryBot = new summaryBotConstructor()
  })

  describe('add vertex', function () {
    it('adds an object of type "vertex"', function () {
      summaryBot._addVertex(['a', 'b'])
      expect(summaryBot.verticies[0]).to.be.an.instanceOf(Vertex)
    })
  })

  describe('proccess string', function () {
    it('creates the same number of vetexes as sentences', function () {
      summaryBot._proccessString('hello a. hi a. greetings a.')
      expect(summaryBot.verticies.length).to.equal(3)
    })
    // it('calls createVertex once for each sentence', () => {
    //   var spyFunc = chai.spy(summaryBot._addVertex)
    //   summaryBot._proccessString('hello. hi. greetings.')
    //   expect(spyFunc).to.have.been.called.exactly(3)
    // })
  })

  describe('_initialize', function () {
    it('every vertex should have one connection', function () {
      summaryBot._proccessString('hello hi. hi a. greetings hello.')
      summaryBot._initialize()
      expect(Object.keys(summaryBot.verticies[0].edge).length).to.equal(2)
    })
    it('should calculate the weight via similarity correctly if 100% similair', () => {
      summaryBot._proccessString('hello hi. hi hello.')
      summaryBot._initialize()
      let otherVert = 1
      expect(summaryBot.verticies[0].edge[1]).to.equal(2 / (2 * Math.log(2)))
    })
  })

  describe('_getEdgeTotals', function () {
    it('returns an array with one entry per vertex', function () {
      summaryBot._proccessString('hello hi. hi sad guy. hello I feel sad.')
      summaryBot._initialize()
      expect(summaryBot._getEdgeTotals().length).to.equal(3)
    })
  })

  describe('_sortVerticiesByWeight', function () {
    it('should sort the verticies descending by weight', function () {
      summaryBot._proccessString('hello my friend. im SO tired. jeez im sleepy.')
      summaryBot._sortVerticiesByWeight()
      expect(summaryBot.verticies[0].weight).to.be.greaterThan(summaryBot.verticies[2].weight)
    })
  })

  describe('run', function() {
    it('should return the original sentence if there are less sentences than requested', function() {
      expect(summaryBot.run('hello.', 2)).to.eql('hello.')
    })
  })
  describe('_updateAllVertexWeights', function () {
    it('works', function () {
      summaryBot._proccessString('In high school, I followed my interest in high fantasy to take a speculative fiction course. This is where I got a real exposure to science fiction. Titles like Lord of Light and The Martian captivated me in the same way that high fantasy did when I was younger. Nowadays, I generally consume a lot less media, whether it be in print or in video. However, when I decided to take a writing course, I knew that I wanted it to be inside the realm of speculative fiction. Looking through the descriptions of all the courses, the only one that really caught my eye was Jewish SF 2290W. Although I have a limited exposure to Jewish culture, I believed that I would have enough to still be able to contribute to the conversation. Entering into the course, I hope that its focus is more on the literary aspects of science fiction. I want us to spend more time focusing on the influences of the author’s past in the text. As such, I wish that we would get more insight into the author’s lives before we read each piece. So far, I’ve found our discussion about the biblical references in I Have No Mouth and I Must Scream to be the most engaging. I think the class would be even more engaging if discussions like that occurred with less guidance. I would prefer if the class was given a topic to discuss instead of a specific question. While that plan may not work given how much content we go through in a single 50-minute class, I think that students should be given a larger opportunity to lead the discussion. I’m excited for the coming semester, and if the first week has been any indication, this class will offer me a lot of insight into both Judaism and science fiction.')
      summaryBot._initialize()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      summaryBot._updateAllVertexWeights()
      console.log(summaryBot.getTopSentences(3))

    })
  })
  describe('run', function () {
    it('return the top setnences', function () {
      console.log(summaryBot.run('They also devise their plan for battling his avowed enemies: the special counsel leading the Russia investigation; the “fake news” media chronicling it; and, in some instances, the president’s own Justice Department overseeing the probe. His advisers have encouraged the calls — which the early-to-rise Trump takes from his private quarters in the White House residence — in hopes that he can compartmentalize the widening Russia investigation. By the time the president arrives for work in the Oval Office, the thinking goes, he will no longer be consumed by the Russia probe that he complains hangs over his presidency like a darkening cloud. It rarely works, however. Asked whether the tactic was effective, one top White House adviser paused for several seconds and then just laughed.Trump’s grievances and moods often bleed into one another. Frustration with the investigation stews inside him until it bubbles up in the form of rants to aides about unfair cable television commentary or as slights aimed at Attorney General Jeff Sessions and his deputy, Rod J. Rosenstein. President Trump listens during a demonstration at the American Leadership in Emerging Technology event in the East Room of the White House on June 22, 2017. (Jabin Botsford/The Washington Post) And, of course, it emerges in fiery tweets about the “WITCH HUNT” — or, as he wrote Thursday morning, shortly before an event promoting leadership in technology, “a big Dem HOAX!” The morning calls reflect another way that Trump’s tumultuous administration is adapting to an unremitting season of investigations and to the president’s seemingly uncontrollable reactions to them. Interviews with 22 senior administration officials, outside advisers, and Trump confidants and allies reveal a White House still trying, after five months of halting progress, to establish a steady rhythm of governance while also indulging and managing Trump’s combative and sometimes self-destructive impulses. The White House is laboring to prevent the Russia matter from overtaking its broader agenda, diligently rolling out a series of theme weeks, focusing on topics including infrastructure and workforce development. West Wing aides are working to keep the president on schedule, trotting him around the country in front of the supportive crowds that energize him. Trump is also planning several big announcements on trade in the coming weeks, before jetting off to Poland and Germany in early July. “This is not astrophysics,” chief strategist Stephen K. Bannon said. “You solidify your base and you grow your base by getting things done. That’s what people want to see.”[Inside Trump’s climate decision: After fiery debate, he ‘stayed where he’s always been’] Senior officials have also been devising an overhaul of the White House communications operation to better meet the offensive and defensive demands of the president they serve, as well as the 24-hour cycle of tweet-size news. “As his detractors suffer from this never-ending ‘Russian concussion,’ the president has been tending to business as usual — bilateral meetings, progress on health care, tax and infrastructure reform, and job creation,” said Kellyanne Conway, counselor to the president. “Conjecture about the mood and momentum of the West Wing is inaccurate and overwrought. The pace is breakneck, the trajectory upward.” White House Chief of Staff Reince Priebus walks out of the White House on June 1, 2017, to await President Trump’s remarks in the Rose Garden about the U.S. role in the Paris climate accord. (Jabin Botsford/The Washington Post) Inside and outside the White House, advisers and friends are also engaging in quiet, informal conversations about when it makes sense for embattled Chief of Staff Reince Priebus to step aside — and who his replacement should be. Some of Priebus’s most senior colleagues speak ill of his leadership abilities, with one tagging him “the most imperiled person here,” although others insist Priebus is in solid standing with the president.Some in the White House fret over what they view as the president’s fits of rage, and Trump’s longtime friends say his mood has been more sour than at any point since they have known him. They privately worry about his health, noting that he appears to have gained weight in recent months and that the darkness around his eyes reveals his stress. But others who interact with Trump each day have a more positive interpretation of his behavior, saying his mood is far sunnier than news reports would suggest. Hope Hicks, Trump’s director of strategic communications, who sits at a desk just outside the Oval Office, said the president is optimistic and expressing the fighting spirit that appeals to voters. Citing his 1987 book, “The Art of the Deal,” Hicks said, “Perhaps President Trump said it best many years ago when he wrote, ‘My general attitude all my life, has been to fight back very hard. . . . [A]s far as I’m concerned, if they had any real ability they wouldn’t be fighting me, they’d be doing something constructive themselves.’ The president promised the American people they elected a fighter and he embodies that with his instincts, spirit and energy.” Many Republicans observing from the outside, however, voice dismay about the president’s behavior. “What’s playing out is a psychological drama, not just a political drama or a legal drama,” said Peter Wehner, who was an aide in George W. Bush’s White House and has frequently been critical of Trump. “The president’s psychology is what’s driving so much of this, and it’s alarming because it shows a lack of self-control, a tremendous tropism. . . . He seems to draw psychic energy from creating chaos and disorder.” [Inside Trump’s anger and impatience — and his sudden decision to fire Comey] After Trump fired James B. Comey as FBI director in May and scrutiny over Russia intensified from investigators and journalists, the president and his inner circle settled on a combative strategy to discredit critics, undermine the probe itself and galvanize his most loyal supporters. The approach also put Bannon on firmer ground after a rocky patch just weeks earlier, in part because of feuds with Jared Kushner, the president’s son-in-law and senior adviser. Trump views Bannon as his wartime consigliere — the sort of political street fighter he wants as his presidency is threatened. “This is a train that’s coming,” said Roger Stone, a former Trump adviser and longtime confidant, referring to the investigation led by special counsel Robert S. Mueller III. “These guys are going to move on him despite the fact that they don’t have a case. The question on the table is what is he going to do about it, and that is a legal and political question.” Trump and his top aides have tried to partition the Russia matter away from official White House business. Although the president’s personal lawyers and communications strategists have counseled him and manage inquiries from the outside the White House, they nonetheless visit the West Wing for meetings and coordinate some matters with administration officials. There is disagreement within the Trump circle about how large the outside legal team should be. It currently is led by Marc E. Kasowitz, a New York-based lawyer who has worked with Trump off and on for several decades. Jay Sekulow, a Washington lawyer with deep ties to the Christian conservative movement, is the public face of the team. Some White House officials said they felt Sekulow got roughed up in a series of television interviews last Sunday, but noted that Trump admires Sekulow’s aggression and polished appearance.', 5, true))
    })
  })
  describe('run3', function () {
    it('prints a reasonable summary', function () {
      console.log(summaryBot.run('Yeah we are equal all over the world added type thing that so called normal to just give it a rest already. Here are I guess you fail at being disabled. If one. Know your superpowers. The best team I ever lead in my career was based on super powers and we even give ourselves anti panty titles like that killer masterly human. Did this get better. The voice of reason. Because we relied on our strengths. Our strength. We achieved tremendous outcomes. \'s treat that prevents me from recognizing my mom about meat smoothly adapt. I quickly absorbed and accurately process and exhausting volume of cues. He\'s out what\'s important determine multiple process either potential for anything to me.', 4, true))
    })
  })
  describe('run with essay 2', function () {
    it('should post something coherent', function () {
      console.log(summaryBot.run('As a genre, cyberpunk has settled into a comfortable pattern: huge technological advances that come at the cost of breakdown of social structure. Corporations that produce radical technology like cyborgs and laser pistols end up becoming the major ruling body of the world. However, just because tropes exist in the genre, that does not mean that there is no room for innovation and tweaking. The cyberpunk universe in Marge Piercy’s He, She and It and in Kazunori Ito’s Ghost in the Shell (1995) display clear divergences that stem from the creators regional and developmental backgrounds. By parsing how each work sets up its world and deals with the definition of humanity, cultural differences between the East and the West can be analyzed.In both Ghost in the Shell and He, She and It, the strength of traditional government fails. In the former, the world has not fallen into complete disarray, nationalities still exist as does each country’s government. However, corporations do have extra liberties. When the police stop a high-level employee, he turns the men around, pulling out his “diplomatic immunity”. In the latter, business runs the world. Besides the free towns, “multis” serve as the last remaining civilized hub. Unfortunately, multis are operated by companies, and as such, every decision is made with the corporation’s best interests in mind. Shira finds this out the hard way when she realizes that if Y-S, her employer, wants “her as badly as they [want] a plasma physicist on Pacifica, she would have sole custody” of her son (435). Both works show the creator’s fear of companies usurping the justice system. However, Piercy’s vision is much darker in comparison. Booker asserts in “Woman on the Edge of a Genre: The Feminist Dystopias of Marge Piercy” that the grim views in He, She, and It stem from being “written during a dark decade for woman’s causes”. Piercy must have felt much more oppressed than Ito, a young Japanese man in Japan. Piercy’s higher level of oppression than Ito further materializes itself in her work when examining the setting of He, She, and It. Her world divides itself into four pieces: the wealthy who live in space, the corporate workers in multis, the few in free towns, and the poor in the Glop. Multis contain a very rigid hierarchy with little latitude for variation. When walking through the streets Shira only sees “four basic patterns of house” (7181). A multi’s control extends much further than trivial matters like décor, even basic human rights like who you make love with is “defined by your place in the hierarchy” (7136). On the other end of the spectrum, free towns display people of all different races, ages, and sexual orientation. Tikva, the free town where most of the story takes place, is founded upon “libertarian socialism with a strong admixture of anarcho-feminism, reconstructionist Judaism… and greeners” (8726). Finally, the Glop spans from Atlanta to Boston. A sprawling mass of humanity, “most kids in the glop never [learn] to read or write” (6725). At first glance, the multis seem to be a haven for humanity while the Glop appears to be the dystopia. However, Booker claims, “Their domed enclaves are… places in which corporate employees live in material comfort, relatively safe from crime, disease, and the ravages of environmental devastation. But for Piercy it is the very orderliness of the enclaves-as opposed to the mess of the Glop – that represents the real dystopia.” I agree with Booker’s argument. As a free-thinker, disease laden slums do not terrify Piercy the most, but sterile environments without freedom of action or thought do. In Ito’s Ghost in the Shell, the setting is much less dystopic. When the audience sees the apartment of a low-level garbage man, we see housing not too far off from a modern apartment, cramped but humane. Again, the contrast between the two pieces comes from the level of oppression and fear for the future that Piercy feels that Ito does not. Piercy uses Tikva to show her ideal post-apocalyptic setting. Booker describes Tikva as a “mostly Jewish community” that is “highly democratic… and is characterized by complete equality between the genders and by tolerance for all forms of non-exploitative sexuality.” Furthermore, Neverow writes in “The Politics of Incorporation and Embodiment: Woman on the Edge of Time and He, She and It as Feminist Epistemologies of Resistance” that Piercy uses Tikva to celebrate marginality to “promote a version of cultural feminist epistemology focused on the politics of personal agency and communal responsibility” (17). Both secondary sources focus on the idea that Piercy uses the setting to show the best case and worst case scenario for communities post apocalypse, and I agree with both of their claims. Tikva only exists because of Piercy’s yearning for a place of acceptance and inclusion, desires that Ito does not feel and therefore he does not express in his work, Ghost in the Shell. Ghost in the Shell takes place in Japan, a hub of technology on the bleeding edge. He, She, and It has no nations, but the world has a strong Japanese flavor. The antagonist corporation’s name is of Japanese origin - “Yakamura-stichen”. In addition, Piercy includes many small details showing the range of Japanese influence throughout the universe. From the pervasiveness of double eyelids as a beauty standard and Japanese lanterns that adorn the interiors of Tikva homes, Japan’s reach extends far. Both stories depict a world in which Japanese culture pulls ahead of the rest of the world. In Ghost in the Shell, when Japan takes charge of the world, Japan has a generally positive influence, furthering technology. Perhaps this stems from Ito’s nationalism, he may think that if Japan dominates the world’s culture, then the world would be better for it. In contrast, in He, She and It, the world is “Japanified” and in ruins. Maybe this comes from being raised in a culture biased against Japan. Both works feature humans with extensive modification. In Ghost in the Shell, all modifications serve solely utility purposes. However, in He, She and It, the modifications also are done for vanity. Ghost in the Shell displays modifications for fighting better, typing quicker, and improving brain function. In He, She and It, characters have retinal clocks (116) and “almost every exec, male or female, [go] under the knife to resemble the Y-S ideal” (190). Both Ito and Piercy foresee a future where man and machine integrate. However, only Piercy discusses her fears of human modification for sameness. Booker thinks that “this emphasis on physical sameness echoes the demand for ideological conformity in which all employees are expected to think and act in accordance with official prescribed corporate policies and goals.” Booker’s argument falls in line with many of my sentiments about Piercy’s inspirations for He, She and It. She used this piece to express her fears for the future. In addition, Piercy expresses her views on equality and gender roles in her work, ideas that Ito completely omits on his work. A large portion of Shira’s narrative involves her love life. From her young love, Gadi, to her husband, Josh, and finally to Yod, Shira’s sexuality spends plenty of time under the microscope. Her grandmother gives the advice that mean are “by and large fine to work with and fun in bed, but never expect much otherwise” (846). Booker further weighs in on the topic of sexuality in He, She and It, saying: “Shira and Yod is continually informed by gender role reversals in which she finds herself occupying the aggressive role that she has traditionally associated with males. Sex for Yod is a matter of intimacy rather than conquest or possession, and he derives his pleasure primarily from pleasing his partner.” These depictions shown are very progressive and feminist in nature. Interestingly, Ghost in the Shell chooses to completely omit any mention of sexuality throughout its narrative. While it may simply be because the movie format allows for much less time for non-critical plot points, as Booker says, “dystopian fiction often focuses on sexuality and relations between the genders.” Ito seems to actively choose to ignore the main character’s sexuality because of the taboo surrounding sexual relationships in Eastern culture. Whereas, Piercy as a Westerner tackles these taboos head-on with her work. Another large issue completely omitted from the Ghost in the Shell narrative is human rights. At no point does the rights of a cyborg versus a human versus an android come into light. On the other hand, He, She and It lays the commentary on heavy with the corporate culture inside of the multis. Only those who rank highly receive rights in Y-S. Shira as a mid-level “techie” claims to have rights (129). However, since her husband has a higher ranking he receives preferential treatment. The rigid class structure in multis wears Japanese influences on its sleeve in terms of how the Japanese structure their corporations. Piercy seems to mix together her fears about the subjugation of humans and her worry about the rising rigid class structure in her depiction of the multis. It seems like Ito does not see class structure as an issue and therefore does not touch upon inside of his work. However, both pieces do not consist of only fears, they also contain visions and hopes for the future. Ghost in the Shell opens with the lines: “In the future electrons and light flow freely, and corporate computer networks eclipse the stars.” Similarly, everyone in He, She and It, even those in the Glop, is on the “Net” (5456). Both pieces share the vision of an interconnected world. They both envision a system where people’s minds can travel through the Net and leave their bodies. In addition, physical modifications have widespread use in both works, allowing people to directly interface with the network. Perhaps, the inclusion of a physical plug into the Net serves as a sign that the creators think that humans will become further integrated with technology. Ghost in the Shell and He, She and It both contain cyberpunk universes. However, each piece decides to comment on different social issues and has a wildly different environment. For the most part, issues that pertain to women and social inequality take centerstage in Piercy’s piece, but they go completely ignored in Ito’s work, even if they are a common trope of cyberpunk. Both stories also include questions about humanity: “What is a human?” They each take a unique set up on the question and answer it in widely different ways indicative of the creator’s environment. He, She and It defines a human by their emotions. When Yod, an android, attempts to gain recognition as both a human and a citizen of Tikva, Shira comforts him, telling him that the people will recognize Yod as a “person fully conscious, a thinking, feeling being” (7920). The physical housing does not seem to matter in being human in He, She and It. This theme takes centerstage when Shira watches Nili perform feats of strength outside of the realm of man. Shira asks whether Nili is a human, to which she gets the response: “that’s a matter of definition… where do you draw the line?” (4119). Piercy seems to takes this opportunity to emphasize that someone being “human” comes down to semantics. In this case, Piercy defines it with emotions. Compared to Eastern culture, Western culture typically gets defined as more emotional and passionate. So, it would be logical that Piercy’s definition of a human consists of the emotional aspects of a being. On the other hand, Ghost in the Shell defines humanity by their memories. While scientists say in the movie that “modern science cannot define what life is.” That does not stop many characters from giving their take on the question. The main character claims: “A face to distinguish yourself from others. A voice you aren’t aware of yourself. The hand you see when you awaken. The memories of childhood, the feelings for the future… All of that goes into make me what I am. Giving rise to a consciousness that I call ‘me’.” Ito further reinforces his definition of a human by introducing a person who receives new memories that manipulate him into shooting the main character, The Major. After eliminating the threat, The Major remarks, “nothings sadder than a puppet without a ghost in them, especially one with red blood in them.” Throughout the story, the term “ghost” corresponds to a human soul, and a “puppet” defines the body they inhabit. In other words, a ghost can inhabit non-human bodies and human bodies can be without a ghost, therefore abstracting the idea of a human soul from the body. Further along in the story, Ito introduces the Puppet Master as a being born completely from the Net. When The Major asks the Puppet Master if he is alive, he responds: Life is like a node which is born within the flow of information. As a species of life that carries DNA as its memory system man gains his individuality from the memories he carries while memories may as well be the same as fantasy, it is by these memories that mankind exists. When computers made it possible to externalize memory you should have considered all the implications that held. The Puppet Master’s assertions that he has a “ghost” because he has memories contributes to Ito’s argument that humanity is based on memories. Now that each work’s definition of a human has been established, let us now look at how each piece grapples with their definition with characters who may or may not be human. In He, She and It, Yod has no organic components. However, Malkah, one of Yod’s creators, insists that “he is a person… not a human person, but a person” (1642). Yod himself seems takes a similar stance noting, “I’m conscious of my existence. I think I plan I feel I react I consume nutrients and exact energy from them. I grow mentally, if not physically, but does the inability to become obese make me less alive?” (2001). By argument, since Yod has emotions, he is human in the context of this novel. However, Shira has doubts whether those emotions are valid. She thinks to herself, “he [is] experiencing a cyborg equivalent to shyness, uncertainty” (3907). She does not think that Yod experiences shyness or uncertainty, but she thinks he experiences a cyborg equivalent. This complicates matters, undeniably, Yod feels emotions, but are the equivalent to human emotions as valid as actual human emotions? Piercy seems to think so. Often, when Shira engages in intercourse with Yod, she feels “confused about… making love with a bunch of biochips” but she rationalizes it, thinking: “[are] biochips more off-putting than intestines?” (3890). Shira is comfortable with Yod’s physical equivalents to human body parts, and is similarly comfortable with Yod’s emotional equivalents. In Ghost in the Shell, The Major resides in a completely synthetic body except for her human brain. Since she contains her memories she feels as if she is human. However, her interactions with the man who had his memories changed shakes The Major’s confidence in herself. She begins to worry that when her mind was transferred to her synthetic body that her memories were tampered. At a certain point, she begins to wonder if she was ever human, or if she was just a complex robot given false memories. Unfortunately, Ito gives no concrete answers as to the validity of The Major’s past. However, by the end of the movie, The Major does not care if her memories of the past are real or not. Like Yod in He, She and It, The Major feels as if her memories are “real enough.” Both pieces define humanity in different ways. Interestingly, both resolve it in a similar fashion, no one can know for certain whether their “humanity” is valid or just a replica, but both stories insist that a replica is just as valid. Perhaps, this feeling is a universal human attitude, one does not have to be “human” simply they must be “human enough”. He, She and It and Ghost in the Shell feature rich cyberpunk universes filled with human modification and cyborgs. However, each piece focuses on different social issues and features different debates on what constitutes a human. By comparing the two works, the differing backgrounds and environments of Ito and Piercy can be analyzed. In addition, the overlaps between the two pieces show us what common fears and hopes for the future two starkly different individuals have.', 5, true))
    })
  })
})
